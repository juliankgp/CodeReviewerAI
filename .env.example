# CodeReviewer Pro - Environment Variables Template
# Copy to .env and fill in your actual values

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================
APP_NAME="CodeReviewer Pro"
APP_VERSION="1.0.0"
DEBUG=true
ENVIRONMENT="development"
SECRET_KEY="your-super-secret-key-change-this-in-production"
API_VERSION="v1"

# =============================================================================
# SERVER CONFIGURATION
# =============================================================================
HOST="0.0.0.0"
PORT=8000
WORKERS=1
RELOAD=true

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL Database
DATABASE_URL="postgresql+asyncpg://codereviewer:codereviewer123@localhost:5432/codereviewer"
DATABASE_ECHO=false
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# Database connection for Alembic migrations
DATABASE_URL_SYNC="postgresql://codereviewer:codereviewer123@localhost:5432/codereviewer"

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_URL="redis://localhost:6379/0"
REDIS_PASSWORD=""
REDIS_TTL=3600
CACHE_PREFIX="codereviewer:"

# =============================================================================
# AUTHENTICATION & SECURITY
# =============================================================================
# JWT Settings
JWT_SECRET_KEY="your-jwt-secret-key-change-this"
JWT_ALGORITHM="HS256"
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Password hashing
PASSWORD_BCRYPT_ROUNDS=12

# CORS settings
ALLOWED_ORIGINS="http://localhost:3000,http://localhost:8080"
ALLOWED_CREDENTIALS=true

# Rate limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=60

# =============================================================================
# MACHINE LEARNING CONFIGURATION
# =============================================================================
# Model settings (optimized for 8GB VRAM)
MODEL_NAME="microsoft/CodeGPT-small-py"  # Smaller model for 8GB constraint
MODEL_FALLBACK="microsoft/DialoGPT-small"  # Even smaller fallback
MODEL_CACHE_DIR="./ml/models"
MODEL_MAX_LENGTH=256  # Reduced for memory efficiency
MODEL_TEMPERATURE=0.7
MODEL_TOP_P=0.9
MODEL_BATCH_SIZE=1  # Must be 1 for 8GB VRAM

# CUDA settings
CUDA_VISIBLE_DEVICES=0
TORCH_CUDA_ARCH_LIST="8.6"
FORCE_CUDA=1

# Quantization settings (aggressive for 8GB VRAM constraint)
USE_QUANTIZATION=true
QUANTIZATION_BITS=4  # 4-bit quantization mandatory for 8GB
LOAD_IN_8BIT=false   # 4-bit more memory efficient
LOAD_IN_4BIT=true    # Required for 8GB VRAM
DEVICE_MAP_AUTO=true # Automatic device mapping
MAX_MEMORY_GB=6      # Reserve 2GB for system/other processes

# LoRA fine-tuning settings (optimized for 8GB)
LORA_R=8             # Reduced rank for memory efficiency
LORA_ALPHA=16        # Reduced alpha proportionally
LORA_DROPOUT=0.1
LORA_TARGET_MODULES="q_proj,v_proj"

# Inference settings (8GB VRAM constraints)
MAX_INFERENCE_TIME=45    # Longer due to memory management
GPU_MEMORY_THRESHOLD=0.85  # More conservative threshold
BATCH_PROCESSING=false   # Disabled for memory safety
GRADIENT_CHECKPOINTING=true  # Enable to save memory
OFFLOAD_TO_CPU=true      # Offload when needed

# =============================================================================
# HUGGING FACE CONFIGURATION
# =============================================================================
HUGGINGFACE_TOKEN="your-huggingface-token-here"
HUGGINGFACE_CACHE_DIR="./ml/models/.cache"
HUGGINGFACE_REPO_ID="your-username/codereviewer-model"
USE_AUTH_TOKEN=true

# =============================================================================
# FILE STORAGE
# =============================================================================
# Local storage
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE=10485760  # 10MB in bytes
ALLOWED_FILE_EXTENSIONS=".py,.js,.ts,.java,.cpp,.c,.h,.cs,.rb,.go,.rs,.php"

# S3-compatible storage (MinIO or AWS S3)
USE_S3_STORAGE=false
S3_BUCKET="codereviewer-uploads"
S3_ENDPOINT="http://localhost:9000"
S3_ACCESS_KEY="minioadmin"
S3_SECRET_KEY="minioadmin123"
S3_REGION="us-east-1"

# =============================================================================
# PAYMENT PROCESSING (STRIPE)
# =============================================================================
STRIPE_PUBLISHABLE_KEY="pk_test_your_stripe_publishable_key"
STRIPE_SECRET_KEY="sk_test_your_stripe_secret_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"
STRIPE_PRICE_BASIC="price_basic_plan_id"
STRIPE_PRICE_PRO="price_pro_plan_id"

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================
EMAIL_ENABLED=true
SMTP_SERVER="smtp.gmail.com"
SMTP_PORT=587
SMTP_USERNAME="your-email@gmail.com"
SMTP_PASSWORD="your-app-password"
FROM_EMAIL="noreply@codereviewerpro.com"
FROM_NAME="CodeReviewer Pro"

# =============================================================================
# MONITORING & LOGGING
# =============================================================================
# Logging
LOG_LEVEL="INFO"
LOG_FORMAT="json"
LOG_FILE="./logs/app.log"
LOG_ROTATION="1 day"
LOG_RETENTION="30 days"

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9000
METRICS_PATH="/metrics"

# Sentry (Error tracking)
SENTRY_DSN="your-sentry-dsn-here"
SENTRY_ENVIRONMENT="development"
SENTRY_TRACES_SAMPLE_RATE=1.0

# OpenTelemetry
OTEL_ENABLED=false
OTEL_ENDPOINT="http://localhost:4317"
OTEL_SERVICE_NAME="codereviewer-pro"

# =============================================================================
# DEVELOPMENT TOOLS
# =============================================================================
# Jupyter Lab
ENABLE_JUPYTER=true
JUPYTER_PORT=8888
JUPYTER_TOKEN=""

# TensorBoard
ENABLE_TENSORBOARD=true
TENSORBOARD_PORT=6006
TENSORBOARD_LOG_DIR="./logs/tensorboard"

# Profiling
ENABLE_PROFILING=false
PROFILE_DIR="./logs/profiles"

# =============================================================================
# API INTEGRATIONS
# =============================================================================
# GitHub API (for repository analysis)
GITHUB_TOKEN="your-github-personal-access-token"
GITHUB_CLIENT_ID="your-github-oauth-client-id"
GITHUB_CLIENT_SECRET="your-github-oauth-client-secret"

# GitLab API
GITLAB_TOKEN="your-gitlab-token"
GITLAB_URL="https://gitlab.com"

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_USER_REGISTRATION=true
FEATURE_SOCIAL_LOGIN=true
FEATURE_FILE_UPLOAD=true
FEATURE_BATCH_PROCESSING=true
FEATURE_REAL_TIME_ANALYSIS=false
FEATURE_ADVANCED_METRICS=true

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
# API Performance
API_TIMEOUT=30
API_MAX_WORKERS=4
API_WORKER_CONNECTIONS=1000

# Database connection pooling
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Caching
CACHE_TTL_SHORT=300      # 5 minutes
CACHE_TTL_MEDIUM=3600    # 1 hour
CACHE_TTL_LONG=86400     # 1 day

# =============================================================================
# HARDWARE OPTIMIZATION (RTX 4070 8GB Specific)
# =============================================================================
GPU_MEMORY_FRACTION=0.75   # More conservative for 8GB
MIXED_PRECISION=true       # Essential for memory savings
GRADIENT_CHECKPOINTING=true # Required for 8GB VRAM
DATALOADER_NUM_WORKERS=2   # Reduced to save memory
PIN_MEMORY=false          # Disabled to save VRAM

# Model optimization (8GB constraints)
USE_FLASH_ATTENTION=false  # Memory intensive, avoid on 8GB
USE_COMPILED_MODEL=false   # Can increase memory usage
OPTIMIZE_FOR_INFERENCE=true
CPU_OFFLOAD=true          # Offload layers to CPU when needed
SEQUENTIAL_CPU_OFFLOAD=true # Sequential offloading for large models

# =============================================================================
# BACKUP & MAINTENANCE
# =============================================================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET="codereviewer-backups"

# Health checks
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10

# =============================================================================
# PRODUCTION OVERRIDES
# =============================================================================
# Set these in production
# DEBUG=false
# ENVIRONMENT="production"
# LOG_LEVEL="WARNING"
# DATABASE_ECHO=false
# RELOAD=false
# WORKERS=4
# USE_QUANTIZATION=true